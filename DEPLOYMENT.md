# Deployment Guide

Complete guide to deploy Project Camp on Render with MongoDB Atlas.

## Table of Contents
- [Prerequisites](#prerequisites)
- [MongoDB Atlas Setup](#mongodb-atlas-setup)
- [GitHub Repository Setup](#github-repository-setup)
- [Render Deployment](#render-deployment)
- [Environment Variables](#environment-variables)
- [Post-Deployment](#post-deployment)
- [Troubleshooting](#troubleshooting)

## Prerequisites

Before deploying, ensure you have:
- [x] A GitHub account
- [x] A MongoDB Atlas account (free tier)
- [x] A Render account (free tier)
- [x] Your project code ready

## MongoDB Atlas Setup

### 1. Create a Cluster

1. Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Sign in or create a free account
3. Click "Build a Database"
4. Select **M0 Free** tier
5. Choose your preferred cloud provider and region
6. Name your cluster (e.g., "ProjectCamp")
7. Click "Create Cluster" (takes 3-5 minutes)

### 2. Create Database User

1. In the left sidebar, click "Database Access"
2. Click "Add New Database User"
3. Choose "Password" authentication method
4. Set username (e.g., `projectcamp_user`)
5. Generate a strong password or create your own
6. **Important:** Save these credentials securely!
7. Under "Database User Privileges", select "Read and write to any database"
8. Click "Add User"

### 3. Configure Network Access

1. In the left sidebar, click "Network Access"
2. Click "Add IP Address"
3. Click "Allow Access from Anywhere"
4. This adds `0.0.0.0/0` (required for Render)
5. Click "Confirm"

### 4. Get Connection String

1. Click "Database" in the left sidebar
2. Click "Connect" on your cluster
3. Select "Connect your application"
4. Choose "Node.js" and latest version
5. Copy the connection string (looks like):
   ```
   mongodb+srv://projectcamp_user:<password>@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
   ```
6. Replace `<password>` with your database user password
7. Add database name at the end: `/projectcamp`
   ```
   mongodb+srv://projectcamp_user:your_password@cluster0.xxxxx.mongodb.net/projectcamp?retryWrites=true&w=majority
   ```

## GitHub Repository Setup

### 1. Initialize Git (if not already done)

```bash
cd C:\Users\ASUS\Desktop\PM
git init
```

### 2. Create .gitignore

Ensure your `.gitignore` includes:
```
node_modules/
.env
*.log
.DS_Store
```

### 3. Create GitHub Repository

1. Go to [GitHub](https://github.com)
2. Click "New Repository"
3. Name it (e.g., "project-camp")
4. Choose "Public" or "Private"
5. Don't initialize with README (you already have one)
6. Click "Create Repository"

### 4. Push Your Code

```bash
git add .
git commit -m "Initial commit - Project Camp"
git branch -M main
git remote add origin https://github.com/yourusername/project-camp.git
git push -u origin main
```

## Render Deployment

### 1. Create Render Account

1. Go to [Render](https://render.com)
2. Sign up (can use GitHub for quick signup)
3. Verify your email

### 2. Create New Web Service

1. Click "New +" button â†’ "Web Service"
2. Click "Connect a repository"
3. Grant Render access to your GitHub
4. Select your repository: `yourusername/project-camp`
5. Click "Connect"

### 3. Configure Service

Render will detect `render.yaml` automatically:

1. **Name**: `projectcamp` (or your preferred name)
2. **Region**: Choose closest to you
3. **Branch**: `main`
4. **Build Command**: `npm install` (auto-detected)
5. **Start Command**: `npm start` (auto-detected)
6. Click "Apply Config" to use `render.yaml`

### 4. Set Environment Variables

You'll need to manually set these:

**Required:**
```
MONGO_URI = mongodb+srv://projectcamp_user:your_password@cluster0.xxxxx.mongodb.net/projectcamp?retryWrites=true&w=majority
```

**Optional (for email features):**
```
MAILTRAP_SMTP_USER = your_mailtrap_username
MAILTRAP_SMTP_PASS = your_mailtrap_password
```

**Auto-generated by Render:**
- `ACCESS_TOKEN_SECRET` - Auto-generated secure random string
- `REFRESH_TOKEN_SECRET` - Auto-generated secure random string
- `FRONTEND_URL` - Auto-set from service URL
- `CROSS_ORIGIN` - Auto-set from service URL
- `PORT` - Set to 8080
- `NODE_ENV` - Set to production

### 5. Deploy

1. Review all settings
2. Click "Create Web Service"
3. Render will start building your application
4. Watch the logs for any errors
5. Deployment takes 2-5 minutes

### 6. Your App is Live!

Once deployed, your app will be available at:
```
https://projectcamp.onrender.com
```
(or whatever name you chose)

## Environment Variables

Complete list of environment variables:

| Variable | Description | Required | Example |
|----------|-------------|----------|---------|
| `NODE_ENV` | Environment mode | Yes | `production` |
| `PORT` | Server port | Yes | `8080` |
| `MONGO_URI` | MongoDB connection | Yes | `mongodb+srv://...` |
| `ACCESS_TOKEN_SECRET` | JWT access token secret | Yes | Auto-generated |
| `ACCESS_TOKEN_EXPIRY` | Access token duration | Yes | `1d` |
| `REFRESH_TOKEN_SECRET` | JWT refresh token secret | Yes | Auto-generated |
| `REFRESH_TOKEN_EXPIRY` | Refresh token duration | Yes | `10d` |
| `FRONTEND_URL` | Frontend URL | Yes | Auto-set |
| `CROSS_ORIGIN` | CORS origin | Yes | Auto-set |
| `MAILTRAP_SMTP_HOST` | Email SMTP host | No | `smtp.mailtrap.io` |
| `MAILTRAP_SMTP_PORT` | Email SMTP port | No | `2525` |
| `MAILTRAP_SMTP_USER` | Email SMTP username | No | Your Mailtrap user |
| `MAILTRAP_SMTP_PASS` | Email SMTP password | No | Your Mailtrap pass |

## Post-Deployment

### 1. Verify Deployment

1. Visit your Render URL
2. You should see the login page
3. Check browser console for errors (F12)

### 2. Test Core Features

1. **Register a new account**
   - Try creating a user
   - Check if it succeeds (email verification may not work without Mailtrap)

2. **Login**
   - Use credentials to login
   - Should redirect to dashboard

3. **Create a project**
   - Test project creation
   - Verify it appears in the list

4. **Create tasks**
   - Add tasks to your project
   - Test status updates

### 3. Monitor Logs

1. Go to Render Dashboard
2. Click on your service
3. Click "Logs" tab
4. Watch for any errors

### 4. Seed Test Data (Optional)

If you want to populate with test users:

1. Go to Render Dashboard â†’ Shell
2. Run: `npm run seed`
3. This creates admin, projectadmin, and member test accounts

## Troubleshooting

### Service Won't Start

**Check logs for errors:**
```
Render Dashboard â†’ Your Service â†’ Logs
```

**Common issues:**
- Missing `MONGO_URI` environment variable
- Invalid MongoDB connection string
- Port already in use (shouldn't happen on Render)

### Can't Connect to MongoDB

**Error: `MongoNetworkError`**

Solutions:
1. Verify MongoDB Atlas cluster is running
2. Check Network Access includes `0.0.0.0/0`
3. Verify connection string format
4. Ensure password doesn't contain special characters that need URL encoding

**Password has special characters?**
Encode them:
- `@` becomes `%40`
- `#` becomes `%23`
- `$` becomes `%24`

### Frontend Not Loading

**Symptoms:** Blank page or "Cannot GET /"

Solutions:
1. Check `public` folder exists
2. Verify `express.static("public")` in `app.js`
3. Check browser console for errors
4. Verify `FRONTEND_URL` matches Render URL

### API Errors

**"User does not exist" or similar errors work, but get HTML instead of JSON:**

This was fixed by adding error middleware to `app.js`:
```javascript
app.use((err, req, res, next) => {
    const statusCode = err.statusCode || 500;
    const message = err.message || "Internal Server Error";
    
    return res.status(statusCode).json({
        statusCode,
        message,
        success: false,
        errors: err.errors || []
    });
});
```

### Slow First Load

**Issue:** First request takes 30+ seconds

This is normal for Render free tier:
- Services spin down after 15 minutes of inactivity
- First request "wakes up" the service
- Subsequent requests are fast

**Solutions:**
- Upgrade to paid plan for always-on service
- Use a service like UptimeRobot to ping your app every 14 minutes
- Accept the limitation for free tier

### Email Not Sending

**Issue:** Registration works but no email received

**If you didn't set up Mailtrap:**
- Email features won't work
- Users can still register and login
- Email verification is optional

**To enable email:**
1. Sign up at [Mailtrap.io](https://mailtrap.io)
2. Get SMTP credentials
3. Add to Render environment variables
4. Redeploy service

## Updating Your Deployment

### Push Updates

```bash
git add .
git commit -m "Your changes"
git push origin main
```

Render automatically redeploys when you push to `main` branch.

### Manual Redeploy

1. Render Dashboard â†’ Your Service
2. Click "Manual Deploy" â†’ "Deploy latest commit"

### Clear Build Cache

If deployment issues persist:
1. Render Dashboard â†’ Your Service â†’ Settings
2. Scroll to "Build & Deploy"
3. Click "Clear Build Cache"
4. Redeploy

## Free Tier Limits

**Render Free Tier:**
- 750 hours/month runtime
- Service sleeps after 15 minutes inactivity
- 500 MB storage
- Shared CPU/RAM
- Perfect for testing and small projects

**MongoDB Atlas Free Tier:**
- 512 MB storage
- Shared RAM
- Automatic backups
- No credit card required
- Perfect for development and small apps

## Upgrading to Production

For production use, consider:

1. **Render Paid Plan** ($7/month)
   - Always-on service
   - More resources
   - Custom domains

2. **MongoDB Atlas Paid Tier**
   - More storage
   - Dedicated resources
   - Advanced monitoring

3. **Email Service**
   - Switch from Mailtrap to SendGrid, AWS SES, or similar
   - Real email delivery

4. **Custom Domain**
   - Add custom domain in Render settings
   - Configure DNS records

## Support

If you encounter issues:

1. Check Render documentation: [render.com/docs](https://render.com/docs)
2. Check MongoDB Atlas docs: [docs.atlas.mongodb.com](https://docs.atlas.mongodb.com)
3. Review application logs in Render dashboard
4. Check GitHub repository issues

## Security Checklist

Before going to production:

- [ ] Change all default passwords
- [ ] Use strong, unique secrets for JWT tokens
- [ ] Enable MongoDB Atlas authentication
- [ ] Review CORS settings
- [ ] Enable HTTPS (automatic on Render)
- [ ] Set up proper error logging
- [ ] Review and limit API rate limits
- [ ] Backup your MongoDB database regularly

---

**Deployment Complete!** ðŸŽ‰

Your Project Camp application is now live and accessible from anywhere in the world.
