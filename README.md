# Project Camp

A full-stack project management application built with Node.js, Express, MongoDB, and vanilla JavaScript.

## Features

- User authentication with JWT
- Project management with role-based access control
- Task management with subtasks
- Project notes
- File attachments for tasks
- Email verification and password reset

## Setup

### Prerequisites

- Node.js v18 or higher
- MongoDB database
- Mailtrap account for email testing

### Installation

1. Clone the repository
2. Install dependencies:
   ```
   npm install
   ```

3. Copy `.env.example` to `.env` and configure:
   ```
   cp .env.example .env
   ```

4. Update `.env` with your credentials:
   - MongoDB connection string
   - JWT secrets
   - Mailtrap SMTP credentials
   - Frontend URL

### Running Locally

Development mode:
```
npm run dev
```

Production mode:
```
npm start
```

### Test Data

Seed the database with test users and sample data:
```
npm run seed
```

This creates three test accounts with different roles:

**Admin (Project Owner)**
- Email: `admin@projectcamp.com`
- Password: `Admin@123`
- Access: Full control - create/update/delete projects, manage members, tasks, notes

**Project Admin**
- Email: `projectadmin@projectcamp.com`
- Password: `Admin@123`
- Access: Manage tasks and subtasks, view notes

**Member**
- Email: `member@projectcamp.com`
- Password: `Member@123`
- Access: View tasks and notes, update subtask completion status

### Understanding Roles

The system uses **project-based roles**, not global user types:

- When you create a project, you automatically become the **admin** (owner) of that project
- You can invite other users and assign them roles within your project:
  - **admin**: Full control over the project
  - **project_admin**: Can manage tasks and subtasks
  - **member**: Can view content and update subtask status
- The same user can have different roles in different projects

To test different permissions, log in with the different test accounts above.

The backend will run on `http://localhost:8080`
The frontend is served from the `public` directory at the same URL

## Deployment on Render

### Prerequisites

1. **GitHub Account** - Push your code to GitHub
2. **MongoDB Atlas Account** - Free tier available at [mongodb.com/cloud/atlas](https://www.mongodb.com/cloud/atlas)
3. **Render Account** - Free at [render.com](https://render.com)

### Step 1: Setup MongoDB Atlas

1. Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) and sign in
2. Create a new free cluster (M0 Sandbox)
3. Click "Database Access" → "Add New Database User"
   - Create username and password (save these!)
   - Set "Built-in Role" to "Read and write to any database"
4. Click "Network Access" → "Add IP Address"
   - Choose "Allow Access from Anywhere" (0.0.0.0/0)
5. Click "Database" → "Connect" → "Connect your application"
   - Copy the connection string
   - Replace `<password>` with your database user password
   - Example: `mongodb+srv://username:password@cluster0.xxxxx.mongodb.net/projectcamp`

### Step 2: Push to GitHub

```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/yourusername/projectcamp.git
git push -u origin main
```

### Step 3: Deploy on Render

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" → "Web Service"
3. Connect your GitHub repository
4. Render will auto-detect the `render.yaml` file
5. Click "Apply" to use the configuration

6. **Set Environment Variables** (will be prompted):
   - `MONGO_URI`: Your MongoDB Atlas connection string from Step 1
   - `MAILTRAP_SMTP_USER`: (Optional) Your Mailtrap username for emails
   - `MAILTRAP_SMTP_PASS`: (Optional) Your Mailtrap password
   
   The following are auto-generated by Render:
   - `ACCESS_TOKEN_SECRET`: Auto-generated
   - `REFRESH_TOKEN_SECRET`: Auto-generated
   - `FRONTEND_URL`: Auto-set from your service URL
   - `CROSS_ORIGIN`: Auto-set from your service URL

7. Click "Create Web Service"

8. Wait 2-3 minutes for deployment to complete

9. Your app will be live at: `https://projectcamp.onrender.com` (or your chosen name)

### Step 4: Test Your Deployment

1. Visit your Render URL
2. Try registering a new account
3. Log in and create a project
4. Test the functionality

### Important Notes

- **Free Tier Limitations**: 
  - Service spins down after 15 minutes of inactivity
  - First request after inactivity takes ~30 seconds to wake up
  - 750 hours/month of runtime (plenty for testing)

- **Email Functionality**:
  - If you skip Mailtrap credentials, email features (verification, password reset) won't work
  - Users can still register and login without email verification for testing

- **Database**: 
  - MongoDB Atlas free tier includes 512MB storage
  - Automatically backs up your data

### Troubleshooting

**Deployment fails:**
- Check Render logs: Dashboard → Your Service → Logs
- Verify `MONGO_URI` is correct and MongoDB Network Access allows all IPs

**Can't connect to MongoDB:**
- Ensure MongoDB Atlas cluster is running (free tier may pause after inactivity)
- Verify Network Access whitelist includes 0.0.0.0/0

**Frontend not loading:**
- Render serves both API and frontend from same URL
- Check browser console for errors
- Verify `FRONTEND_URL` matches your Render service URL

### Manual Deployment (Alternative)

If you prefer not to use `render.yaml`:

1. Create Web Service manually
2. Set Build Command: `npm install`
3. Set Start Command: `npm start`
4. Set Environment: `Node`
5. Add all environment variables listed above

For detailed deployment instructions, see [DEPLOYMENT.md](DEPLOYMENT.md)

### MongoDB Atlas Setup

1. Create a free cluster at [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Create a database user with read/write access
3. Whitelist all IPs (0.0.0.0/0) in Network Access
4. Get connection string: `mongodb+srv://username:password@cluster.mongodb.net/projectcamp`
5. Replace `<password>` with your actual database password

### Optional: Email Setup with Mailtrap

1. Sign up at [Mailtrap](https://mailtrap.io)
2. Go to Email Testing → Inboxes → SMTP Settings
3. Copy Username and Password
4. Add to Render environment variables

### Generate Secrets Locally

For local development, generate secure secrets:
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

Add these to your `.env` file for `ACCESS_TOKEN_SECRET` and `REFRESH_TOKEN_SECRET`

## Production Considerations

## API Documentation

### Authentication Endpoints
- POST `/api/v1/auth/register` - Register new user
- POST `/api/v1/auth/login` - Login user
- POST `/api/v1/auth/logout` - Logout user
- GET `/api/v1/auth/current-user` - Get current user
- POST `/api/v1/auth/change-password` - Change password
- POST `/api/v1/auth/refresh-token` - Refresh access token
- GET `/api/v1/auth/verify-email/:token` - Verify email
- POST `/api/v1/auth/forgot-password` - Request password reset
- POST `/api/v1/auth/reset-password/:token` - Reset password

### Project Endpoints
- GET `/api/v1/projects` - Get user projects
- POST `/api/v1/projects` - Create project
- GET `/api/v1/projects/:projectId` - Get project details
- PUT `/api/v1/projects/:projectId` - Update project
- DELETE `/api/v1/projects/:projectId` - Delete project
- GET `/api/v1/projects/:projectId/members` - Get project members
- POST `/api/v1/projects/:projectId/members` - Add member
- PUT `/api/v1/projects/:projectId/members/:userId` - Update member role
- DELETE `/api/v1/projects/:projectId/members/:userId` - Remove member

### Task Endpoints
- GET `/api/v1/tasks/:projectId` - Get project tasks
- POST `/api/v1/tasks/:projectId` - Create task
- GET `/api/v1/tasks/:projectId/t/:taskId` - Get task details
- PUT `/api/v1/tasks/:projectId/t/:taskId` - Update task
- DELETE `/api/v1/tasks/:projectId/t/:taskId` - Delete task
- POST `/api/v1/tasks/:projectId/t/:taskId/subtasks` - Create subtask
- PUT `/api/v1/tasks/:projectId/st/:subTaskId` - Update subtask
- DELETE `/api/v1/tasks/:projectId/st/:subTaskId` - Delete subtask

### Note Endpoints
- GET `/api/v1/notes/:projectId` - Get project notes
- POST `/api/v1/notes/:projectId` - Create note
- GET `/api/v1/notes/:projectId/n/:noteId` - Get note details
- PUT `/api/v1/notes/:projectId/n/:noteId` - Update note
- DELETE `/api/v1/notes/:projectId/n/:noteId` - Delete note

## License

ISC
